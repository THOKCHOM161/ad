
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leviathans Hub</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4cc9f0;
      --success-color: #4ad66d;
      --danger-color: #f72585;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --gray-color: #6c757d;
      --border-radius: 12px;
      --box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7ff;
      color: var(--dark-color);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    
    .container {
      width: 90%;
      max-width: 400px;
      margin: 30px auto;
      background: white;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      position: relative;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    h2 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 20px;
      font-weight: 600;
      font-size: 1.8rem;
    }
    
    h3 {
      color: var(--secondary-color);
      margin: 15px 0 10px;
      font-size: 1.3rem;
    }
    
    h4 {
      color: var(--dark-color);
      margin: 12px 0 8px;
      font-size: 1.1rem;
    }
    
    input, select {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: var(--border-radius);
      border: 1px solid #e0e0e0;
      font-size: 16px;
      transition: var(--transition);
      background: var(--light-color);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
    }
    
    button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: var(--border-radius);
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      background: var(--primary-color);
      color: white;
    }
    
    button:hover {
      background: var(--secondary-color);
      transform: translateY(-1px);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .hidden {
      display: none;
    }
    
    .dashboard {
      text-align: center;
    }
    
    .stats {
      background: linear-gradient(135deg, #f5f7ff 0%, #e8ecff 100%);
      padding: 20px;
      border-radius: var(--border-radius);
      margin: 15px 0;
      border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .stats p {
      margin: 8px 0;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
    }
    
    .stats p b {
      color: var(--gray-color);
      font-weight: 500;
    }
    
    .ads {
      margin-top: 25px;
      padding: 20px;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    
    #viewAdBtn {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
      margin-bottom: 15px;
    }
    
    #viewAdBtn:hover {
      background: linear-gradient(135deg, var(--secondary-color) 0%, #3aa8d8 100%);
    }
    
    #viewAdBtn:disabled {
      background: var(--gray-color);
      transform: none;
      cursor: not-allowed;
    }
    
    .withdraw-form {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-top: 20px;
      border: 1px solid rgba(0,0,0,0.05);
    }
    
    .withdraw-history {
      margin-top: 25px;
      text-align: left;
    }
    
    .withdraw-item {
      background: white;
      padding: 15px;
      border-radius: var(--border-radius);
      margin: 10px 0;
      box-shadow: var(--box-shadow);
      font-size: 14px;
      border-left: 4px solid var(--primary-color);
    }
    
    .ad-progress {
      height: 8px;
      background: #e0e0e0;
      border-radius: 10px;
      margin: 15px 0;
      overflow: hidden;
    }
    
    .ad-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--success-color) 0%, #2ecc71 100%);
      border-radius: 10px;
      width: 0%;
      transition: width 1s linear;
    }
    
    #cooldownText {
      font-size: 14px;
      color: var(--gray-color);
      margin-top: 10px;
    }
    
    /* Navigation elements */
    .hamburger {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      cursor: pointer;
      z-index: 100;
      color: var(--primary-color);
      background: white;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .logout-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--danger-color);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      width: auto;
      box-shadow: 0 2px 10px rgba(247, 37, 133, 0.3);
    }
    
    .logout-btn:hover {
      background: #d3166d;
      transform: translateY(-1px);
    }
    
    /* Admin panel */
    .admin-panel {
      position: fixed;
      top: 0;
      left: -300px;
      width: 280px;
      height: 100%;
      background: white;
      box-shadow: 2px 0 15px rgba(0,0,0,0.1);
      padding: 20px;
      transition: all 0.3s ease;
      z-index: 99;
      overflow-y: auto;
    }
    
    .admin-panel.active {
      left: 0;
    }
    
    .admin-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 98;
      display: none;
      backdrop-filter: blur(3px);
    }
    
    .admin-overlay.active {
      display: block;
    }
    
    /* Admin controls */
    .admin-controls {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    
    .admin-controls button {
      padding: 8px 12px;
      font-size: 12px;
      border-radius: 8px;
      flex: 1;
      min-width: 60px;
    }
    
    /* Links */
    a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }
    
    a:hover {
      text-decoration: underline;
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .container {
        width: 95%;
        padding: 20px 15px;
      }
      
      h2 {
        font-size: 1.5rem;
      }
      
      input, button, select {
        padding: 12px;
      }
    }
</style>
</head>
<body>
  <!-- Hamburger icon (visible on dashboard) -->
  <div class="hamburger hidden" id="hamburgerMenu">â˜°</div>
  
  <!-- Logout button -->
  <button class="logout-btn hidden" id="logoutBtn" onclick="logout()">Logout</button>
  
  <!-- Admin overlay (for closing panel) -->
  <div class="admin-overlay" id="adminOverlay"></div>
  
  <!-- Admin panel -->
  <div class="admin-panel" id="adminPanel">
    <h3>Admin Panel</h3>
    <input type="password" id="adminPassword" placeholder="Enter admin password">
    <button onclick="unlockAdmin()">Unlock</button>
    
    <div id="adminContent" class="hidden">
      <h4>Registered Users</h4>
      <div id="usersList"></div>
      
      <h4>Withdraw Requests</h4>
      <div id="withdrawRequests"></div>
    </div>
  </div>

  <!-- Register -->
  <div id="registerPage" class="container">
    <h2>Register</h2>
    <input type="text" id="regUsername" placeholder="Username">
    <input type="text" id="regPhone" placeholder="Phone Number">
    <input type="password" id="regPassword" placeholder="Password">
    <button onclick="register()">Register</button>
    <p>Already have account? <a href="#" onclick="showLogin()">Login</a></p>
  </div>

  <!-- Login -->
  <div id="loginPage" class="container hidden">
    <h2>Login</h2>
    <input type="text" id="loginPhone" placeholder="Phone Number">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboardPage" class="container hidden">
    <h2>Welcome to Leviathans Hub</h2>
    <div class="dashboard">
      <div class="stats">
        <p><b>Today's Earnings:</b> <span id="todayEarnings">0</span></p>
        <p><b>Total Earnings:</b> <span id="totalEarnings">0</span></p>
      </div>
      <button onclick="showWithdrawOptions()">Withdraw Earnings</button>
      <div class="ads">
        <button id="viewAdBtn" onclick="viewAd()">Watch Ad Now</button>
        <p>Ads watched today: <span id="adsWatched">0</span>/<span id="dailyLimit">100</span></p>
        <div class="ad-progress">
          <div class="ad-progress-bar" id="adProgressBar"></div>
        </div>
        <p id="cooldownText" style="display:none;">Please wait <span id="cooldownTimer">10</span> seconds</p>
      </div>
      <div id="withdrawSection" class="withdraw-form hidden">
        <select id="withdrawMethod">
          <option value="jazzcash">JazzCash</option>
          <option value="easypaisa">EasyPaisa</option>
        </select>
        <input type="text" id="holderName" placeholder="Account Holder Name">
        <input type="text" id="accountNumber" placeholder="Account Number">
        <button onclick="submitWithdraw()">Submit Withdraw</button>
      </div>
      <div id="withdrawHistory" class="withdraw-history"></div>
    </div>
  </div>

  <script>
    // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Install Prompt
        let deferredPrompt;
        const installBtn = document.createElement('button');
        installBtn.id = 'installBtn';
        installBtn.className = 'install-btn';
        installBtn.textContent = 'Install App';
        installBtn.style.display = 'none';
        document.body.appendChild(installBtn);
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
            
            installBtn.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    installBtn.style.display = 'none';
                });
            });
        });

        window.addEventListener('appinstalled', () => {
            installBtn.style.display = 'none';
            console.log('PWA was installed');
        });

        window.addEventListener('load', () => {
            if (window.matchMedia('(display-mode: standalone)').matches) {
                installBtn.style.display = 'none';
            }
        });
    // Firebase config
    const firebaseConfig = {  
      apiKey: "AIzaSyB3uXd_gn5WuL0t0gv0Qyt_c7iIgeXV9mc",  
      authDomain: "hati-4707b.firebaseapp.com",  
      projectId: "hati-4707b",  
      databaseURL: "https://hati-4707b-default-rtdb.firebaseio.com/",  
      storageBucket: "hati-4707b.appspot.com",  
      messagingSenderId: "209757591816",  
      appId: "1:209757591816:web:c0f06a5829143f75d074bd"  
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null;
    let adCooldown = false;
    let cooldownInterval;
    let timeLeft = 10;

    // Hamburger menu toggle
    document.getElementById('hamburgerMenu').addEventListener('click', function() {
      document.getElementById('adminPanel').classList.toggle('active');
      document.getElementById('adminOverlay').classList.toggle('active');
    });
    
    // Close admin panel when clicking overlay
    document.getElementById('adminOverlay').addEventListener('click', function() {
      document.getElementById('adminPanel').classList.remove('active');
      document.getElementById('adminOverlay').classList.remove('active');
    });

    function showLogin(){
      document.getElementById('registerPage').classList.add('hidden');
      document.getElementById('loginPage').classList.remove('hidden');
    }

    function showRegister(){
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('registerPage').classList.remove('hidden');
    }

    function register(){
      let username = document.getElementById('regUsername').value;
      let phone = document.getElementById('regPhone').value;
      let pass = document.getElementById('regPassword').value;
      if(!username || !phone || !pass) return alert("Fill all fields");
      db.ref('users/'+phone).set({username,phone,password:pass,total:0,today:0,adsWatched:0,dailyLimit:100,withdraws:{}});
      alert("Registered successfully");
      showLogin();
    }

    function login(){
      let phone = document.getElementById('loginPhone').value;
      let pass = document.getElementById('loginPassword').value;
      db.ref('users/'+phone).once('value').then(snap=>{
        if(snap.exists() && snap.val().password===pass){
          currentUser = snap.val();
          currentUser.phone = phone;
          loadDashboard();
        } else alert("Invalid login");
      });
    }

    function logout() {
      currentUser = null;
      document.getElementById('dashboardPage').classList.add('hidden');
      document.getElementById('hamburgerMenu').classList.add('hidden');
      document.getElementById('logoutBtn').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('active');
      document.getElementById('adminOverlay').classList.remove('active');
      document.getElementById('adminContent').classList.add('hidden');
      document.getElementById('loginPage').classList.remove('hidden');
    }

    function loadDashboard(){
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('registerPage').classList.add('hidden');
      document.getElementById('dashboardPage').classList.remove('hidden');
      document.getElementById('hamburgerMenu').classList.remove('hidden');
      document.getElementById('logoutBtn').classList.remove('hidden');
      updateUI();
    }

    function updateUI(){
      db.ref('users/'+currentUser.phone).on('value', snap=>{
        currentUser = snap.val();
        document.getElementById('todayEarnings').innerText = currentUser.today || 0;
        document.getElementById('totalEarnings').innerText = currentUser.total || 0;
        document.getElementById('adsWatched').innerText = currentUser.adsWatched || 0;
        document.getElementById('dailyLimit').innerText = currentUser.dailyLimit || 100;
        loadWithdrawHistory();
      });
    }

    function viewAd(){
      if(currentUser.adsWatched >= currentUser.dailyLimit) return alert("Daily ad limit reached");
      if(adCooldown) return alert("Wait "+timeLeft+" seconds before next ad");
      
      // Open ad in new tab automatically
      let adWindow = window.open("https://otieu.com/4/9712101", "_blank");
      
      // If popup blocked, show alert
      if(!adWindow || adWindow.closed || typeof adWindow.closed=='undefined') {
        alert("Please allow popups to watch ads");
        return;
      }
      
      adCooldown = true;
      timeLeft = 10;
      document.getElementById('viewAdBtn').disabled = true;
      document.getElementById('cooldownText').style.display = 'block';
      document.getElementById('cooldownTimer').innerText = timeLeft;
      
      cooldownInterval = setInterval(()=>{
        timeLeft--;
        document.getElementById('cooldownTimer').innerText = timeLeft;
        document.getElementById('adProgressBar').style.width = (100 - (timeLeft/10*100)) + '%';
        
        if(timeLeft <= 0){
          clearInterval(cooldownInterval);
          adCooldown = false;
          db.ref('users/'+currentUser.phone).update({
            adsWatched: (currentUser.adsWatched||0)+1,
            today: (currentUser.today||0)+0.055,
                        total: (currentUser.total||0)+0.055,
          });
          document.getElementById('viewAdBtn').disabled = false;
          document.getElementById('cooldownText').style.display = 'none';
          document.getElementById('adProgressBar').style.width = '0%';
        }
      }, 1000);
    }

    function showWithdrawOptions(){
      document.getElementById('withdrawSection').classList.toggle('hidden');
    }

    function submitWithdraw(){
      let method = document.getElementById('withdrawMethod').value;
      let holder = document.getElementById('holderName').value;
      let acc = document.getElementById('accountNumber').value;
      if(!holder || !acc) return alert("Fill fields");
      let id = Date.now();
      db.ref('users/'+currentUser.phone+'/withdraws/'+id).set({method,holder,acc,status:'pending',message:''});
      alert("Withdraw request sent");
    }

    function loadWithdrawHistory(){
      let historyBox = document.getElementById('withdrawHistory');
      historyBox.innerHTML = "<h3>Withdraw History</h3>";
      if(currentUser.withdraws){
        Object.keys(currentUser.withdraws).forEach(id=>{
          let w = currentUser.withdraws[id];
          historyBox.innerHTML += `<div class='withdraw-item'>${w.method} - ${w.holder} - ${w.acc} - ${w.status} (${w.message})</div>`;
        });
      }
    }
    
    // Admin functions
    function unlockAdmin() {
      const password = document.getElementById('adminPassword').value;
      if(password === "happy") {
        document.getElementById('adminContent').classList.remove('hidden');
        loadAdminData();
      } else {
        alert("Incorrect admin password");
      }
    }
    
    function loadAdminData() {
      // Load users list
      db.ref('users').on('value', snap => {
        const usersList = document.getElementById('usersList');
        usersList.innerHTML = '';
        
        snap.forEach(user => {
          const userData = user.val();
          usersList.innerHTML += `
            <div style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
              <strong>${userData.username || 'No name'}</strong> (${userData.phone})<br>
              Ads: ${userData.adsWatched || 0}/${userData.dailyLimit || 100}<br>
              Balance: Rs ${userData.today || 0}<br>
              Total: Rs ${userData.total || 0}
              <div class="admin-controls">
                <button onclick="changeUserLimit('${userData.phone}', 1)">+ Limit</button>
                <button onclick="changeUserLimit('${userData.phone}', -1)">- Limit</button>
                <button onclick="resetUserAds('${userData.phone}')" style="background: #ff9800;">Reset Ads</button>
              </div>
            </div>
          `;
        });
      });
      
      // Load withdraw requests
      db.ref('users').on('value', snap => {
        const withdrawRequests = document.getElementById('withdrawRequests');
        withdrawRequests.innerHTML = '';
        
        snap.forEach(user => {
          const userData = user.val();
          if(userData.withdraws) {
            Object.keys(userData.withdraws).forEach(id => {
              const withdraw = userData.withdraws[id];
              if(withdraw.status === 'pending') {
                withdrawRequests.innerHTML += `
                  <div style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <strong>${userData.username}</strong> (${userData.phone})<br>
                    Method: ${withdraw.method}<br>
                    Account: ${withdraw.holder} - ${withdraw.acc}<br>
                    Amount: Rs ${withdraw.amount || 0}<br>
                    <input type="text" id="adminMsg${id}" placeholder="Message"><br>
                    <button onclick="approveWithdraw('${userData.phone}', '${id}')" style="background: #4CAF50; margin-top: 5px;">Approve</button>
                    <button onclick="rejectWithdraw('${userData.phone}', '${id}')" style="background: #f44336; margin-top: 5px;">Reject</button>
                  </div>
                `;
              }
            });
          }
        });
      });
    }
    
    function changeUserLimit(phone, change) {
      db.ref(`users/${phone}`).once('value').then(snap => {
        const user = snap.val();
        const newLimit = Math.max(0, (user.dailyLimit || 100) + change);
        db.ref(`users/${phone}`).update({ dailyLimit: newLimit });
        alert(`Daily limit updated to ${newLimit} for ${user.username}`);
      });
    }
    
    function resetUserAds(phone) {
      if(confirm("Reset this user's ad count?")) {
        db.ref(`users/${phone}`).update({
          adsWatched: 0
        });
        alert("Ad count reset");
      }
    }
    
    function approveWithdraw(phone, id) {
      const message = document.getElementById(`adminMsg${id}`).value || 'Approved';
      db.ref(`users/${phone}/withdraws/${id}`).update({
        status: 'approved',
        message: message
      });
      alert("Withdrawal approved");
    }
    
    function rejectWithdraw(phone, id) {
      const message = document.getElementById(`adminMsg${id}`).value || 'Rejected';
      db.ref(`users/${phone}/withdraws/${id}`).update({
        status: 'rejected',
        message: message
      });
      
      // Return the amount to user's balance
      db.ref(`users/${phone}`).once('value').then(snap => {
        const user = snap.val();
        const withdrawAmount = user.withdraws[id].amount || 0;
        db.ref(`users/${phone}`).update({
          today: (user.today || 0) + withdrawAmount
        });
      });
      
      alert("Withdrawal rejected");
    }
  </script>
</body>
</html>
